<Page
    x:Class="UWP.Views.CoinDetails"
    x:DefaultBindMode="OneWay"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:helpers="using:UWP.Helpers"
    xmlns:userControls="using:UWP.UserControls"
    xmlns:viewModels="using:UWP.ViewModels"
    mc:Ignorable="d"
    Unloaded="Page_Unloaded"
    NavigationCacheMode="Disabled">

    <Page.DataContext>
        <viewModels:CoinDetailsViewModel x:Name="vm"/>
    </Page.DataContext>

    <Page.Resources>
        <Style TargetType="Button" x:Key="IconBtn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Opacity" Value="0.75"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="5 0"/>
            <Setter Property="Margin" Value="5 0"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="FontFamily" Value="{StaticResource FluentIconFont}"/>
            <Setter Property="FontSize" Value="20"/>
        </Style>
        <Style TargetType="RelativePanel" x:Key="AboutRelativePanelStyle">
            <Setter Property="Margin" Value="0, 8"/>
            <Setter Property="BorderBrush" Value="LightGray"/>
            <Setter Property="BorderThickness" Value="0, 0.5, 0, 0"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
        </Style>
        <Style TargetType="StackPanel" x:Key="CardStackPanel">
            <Setter Property="Background" Value="{ThemeResource SystemControlPageBackgroundChromeLowBrush}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="5"/>
        </Style>
        <Style TargetType="Grid" x:Key="CardGrid">
            <Setter Property="Background" Value="{ThemeResource SystemControlPageBackgroundChromeLowBrush}"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="5"/>
        </Style>
        <Style TargetType="RelativePanel" x:Key="CardRelativePanelTitle">
            <Setter Property="Margin" Value="10 0"/>
            <Setter Property="BorderBrush" Value="{ThemeResource DefaultTextForegroundThemeBrush}"/>
            <Setter Property="BorderThickness" Value="0 0 0 1"/>
        </Style>
        <helpers:StringFormatConverter x:Key="StringFormatConverter"/>
        <helpers:NumberPrefixConverter x:Key="NumberPrefixer"/>
        <helpers:DateTimeShortener x:Key="DateShortener"/>
    </Page.Resources>

    <Grid x:Name="MainGrid" Padding="5, 0" Background="{ThemeResource SystemControlBackgroundChromeMediumBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="5*" MinHeight="380" MaxHeight="500" x:Name="ChartRow"/>
            <RowDefinition Height="4*"/>
        </Grid.RowDefinitions>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState x:Name="UltraNarrow">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="UniformGrid.Columns" Value="1"/>
                        <Setter Target="UniformGrid.Rows" Value="5"/>
                        <Setter Target="UniformGrid.Height" Value="900"/>
                    </VisualState.Setters>
                </VisualState>

                <VisualState x:Name="Narrow">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="600"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="UniformGrid.Columns" Value="2"/>
                        <Setter Target="UniformGrid.Rows" Value="3"/>
                        <Setter Target="UniformGrid.Height" Value="550"/>
                    </VisualState.Setters>
                </VisualState>

                <VisualState x:Name="Wide">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="900"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="UniformGrid.Columns" Value="3"/>
                        <Setter Target="UniformGrid.Rows" Value="2"/>
                        <Setter Target="UniformGrid.Height" Value="370"/>
                        <Setter Target="ChartRow.MaxHeight" Value="850"/>
                    </VisualState.Setters>
                </VisualState>

                <VisualState x:Name="UltraWide">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1300"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="UniformGrid.Columns" Value="4"/>
                        <Setter Target="UniformGrid.Rows" Value="2"/>
                        <Setter Target="UniformGrid.Height" Value="370"/>
                        <Setter Target="InfoCard.(Grid.ColumnSpan)" Value="2"/>
                        <Setter Target="ChartRow.MaxHeight" Value="900"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 
        ####################################################################################################
        ############################################### Page Title #########################################
        #################################################################################################### -->
        <Grid BorderThickness="0 0 0 0.5" BorderBrush="{ThemeResource SystemControlForegroundChromeHighBrush}">
            <StackPanel Orientation="Horizontal">
                <Image
                    d:Source="/Assets/Icons/iconBTC.png"
                    Source="{x:Bind vm.Coin.Logo}"
                    Margin="10 0" Width="32"/>
                <StackPanel Orientation="Vertical" Margin="0">
                    <TextBlock
                        d:Text="Bitcoin"
                        Text="{x:Bind vm.Coin.FullName}"
                        Margin="1 0 0 -7"
                        FontSize="22"
                        FontWeight="SemiBold"
                        Style="{StaticResource TitleTextBlockStyle}"/>
                    <TextBlock
                        FontWeight="Normal"
                        d:Text="BTC"
                        CharacterSpacing="50"
                        Text="{x:Bind vm.Coin.Name}"
                        Opacity="0.5"/>
                </StackPanel>
                <Button
                    d:Content="&#xEB51;"
                    Click="FavCoin_click"
                    Content="{x:Bind vm.Coin.FavIcon}"
                    ToolTipService.ToolTip="Toggle favourite"
                    Style="{StaticResource IconBtn}"/>
                <Button
                    d:Content="&#xE840;"
                    Click="PinCoin_click"
                    Content="{x:Bind vm.Coin.PinIcon}"
                    ToolTipService.ToolTip="Toggle pin to start screen"
                    Style="{StaticResource IconBtn}"/>
                <Button
                    d:Visibility="Visible" x:Name="CompactOverlay_btn"
                    Content="&#xE8a7;" Click="CompactOverlay_btn_click"
                    Visibility="Collapsed"
                    ToolTipService.ToolTip="Compact overlay"
                    Style="{StaticResource IconBtn}"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Margin="5 0" HorizontalAlignment="Right" VerticalAlignment="Center">
                <TextBlock
                    d:Text="1000€"
                    FontSize="26"
                    FontWeight="SemiBold"
                    CharacterSpacing="-25"
                    Style="{ThemeResource TitleTextBlockStyle}">
                    <Run Text="{x:Bind vm.Coin.Price, Converter={StaticResource NumberFormatter}}"/><!--
                    --><Run Text="{x:Bind vm.Coin.CurrencySym}"/>
                </TextBlock>

                <userControls:DiffTextBlock
                    Diff="{x:Bind vm.Coin.Diff}"
                    DiffFg="{x:Bind vm.Coin.DiffFG}"
                    Margin="0 8 0 0"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal">
                
            </StackPanel>
        </Grid>

        <!-- 
        ####################################################################################################
        ############################################### Price Chart ########################################
        #################################################################################################### -->
        <Grid Grid.Row="2" Grid.Column="0" Opacity="{x:Bind vm.Coin.Opacity}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>

            <controls:Loading
                IsLoading="{x:Bind vm.Coin.IsLoading}"
                HorizontalAlignment="Center" VerticalAlignment="Center"
                Grid.RowSpan="2" Grid.ColumnSpan="2"
                Background="Transparent">
                <ContentControl>
                    <ProgressBar
                        Background="Transparent"
                        IsIndeterminate="True"
                        Foreground="{ThemeResource SystemControlBackgroundBaseMediumBrush}"
                        Width="600"/>
                </ContentControl>
            </controls:Loading>

            <userControls:ChartAreaFull
                x:Name="PriceChart"
                ChartModel="{x:Bind vm.Chart}"
                ShowCandles="{x:Bind vm.ShowCandles}"/>

            <Grid Grid.Row="1" HorizontalAlignment="Stretch" Margin="5 0">
                <Button
                    Click="ShowCandles_Click"
                    Style="{StaticResource IconBtn}">
                    <Button.Content>
                        <PathIcon                            
                            Data="M12 0.999999C12 0.729156 12.099 0.494781 12.2969 0.296875C12.4948 0.0989684 12.7292 0 13 0L15 0C15.2708 0 15.5052 0.0989684 15.7031 0.296875C15.901 0.494781 16 0.729156 16 0.999999L16 13C16 13.2708 15.901 13.5052 15.7031 13.7031C15.5052 13.901 15.2708 14 15 14L13 14C12.7292 14 12.4948 13.901 12.2969 13.7031C12.099 13.5052 12 13.2708 12 13L12 0.999999ZM3 4C3.27084 4 3.50522 4.09897 3.70312 4.29687C3.90103 4.49478 4 4.72916 4 5L4 13C4 13.2708 3.90103 13.5052 3.70312 13.7031C3.50522 13.901 3.27084 14 3 14L1 14C0.729156 14 0.494781 13.901 0.296875 13.7031C0.0989685 13.5052 0 13.2708 0 13L0 5C0 4.72916 0.0989685 4.49478 0.296875 4.29687C0.494781 4.09897 0.729156 4 1 4L3 4ZM9 8C9.27084 8 9.50522 8.09897 9.70312 8.29688C9.90103 8.49478 10 8.72916 10 9L10 13C10 13.2708 9.90103 13.5052 9.70312 13.7031C9.50522 13.901 9.27084 14 9 14L7 14C6.72916 14 6.49478 13.901 6.29688 13.7031C6.09897 13.5052 6 13.2708 6 13L6 9C6 8.72916 6.09897 8.49478 6.29688 8.29688C6.49478 8.09897 6.72916 8 7 8L9 8Z"
                            VerticalAlignment="Center" HorizontalAlignment="Center" />
                    </Button.Content>
                </Button>
                <userControls:TimeRangeRadioButtons
                    Grid.Row="1" TimeSpan="{x:Bind vm.Chart.TimeSpan}"
                    HorizontalAlignment="Center"
                    Tapped="TimeRangeButtons_Tapped"/>
                <Button
                    Content="&#xE9A6;"
                    HorizontalAlignment="Right"
                    Style="{StaticResource IconBtn}"/>
            </Grid>
        </Grid>

        <!-- 
        ####################################################################################################
        ############################################## Bottom Cards ########################################
        #################################################################################################### -->
        
        <Pivot Grid.Row="3" MaxWidth="700" BorderBrush="Black" BorderThickness="2" Margin="0 5">
            <PivotItem Header="Overview">

            </PivotItem>
            
            <PivotItem Header="Alerts">

            </PivotItem>

            <PivotItem Header="Portfolio">

            </PivotItem>
        </Pivot>

        <ScrollViewer Grid.Row="3" Margin="0 5" Visibility="Visible">

            <Grid x:Name="BottomCards">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <controls:UniformGrid Grid.Row="0" x:Name="UniformGrid" Rows="3" Columns="2" Height="700">

                    <!-- Info card -->
                    <Grid x:Name="InfoCard" Style="{ThemeResource CardGrid}" Grid.RowSpan="2" Grid.ColumnSpan="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <RelativePanel Style="{ThemeResource CardRelativePanelTitle}">
                            <TextBlock Text="Information" Style="{ThemeResource SubtitleTextBlockStyle}" FontWeight="Bold"/>
                        </RelativePanel>

                        <ScrollViewer Grid.Row="1" Margin="15" VerticalAlignment="Stretch" VerticalContentAlignment="Stretch">
                            <TextBlock Text="{x:Bind vm.CoinInfo.description.en}" TextWrapping="WrapWholeWords"
                                       TextAlignment="Justify" Opacity="0.8"/>
                        </ScrollViewer>
                    </Grid>


                    <!-- Stats card -->
                    <StackPanel Style="{ThemeResource CardStackPanel}">
                        <StackPanel.Resources>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="Light"/>
                                <Setter Property="FontSize" Value="16"/>
                                <Setter Property="Margin" Value="5"/>
                            </Style>
                        </StackPanel.Resources>
                        <RelativePanel Style="{ThemeResource CardRelativePanelTitle}">
                            <TextBlock Text="Stats" Style="{ThemeResource SubtitleTextBlockStyle}" FontWeight="Bold"/>
                        </RelativePanel>

                        <controls:UniformGrid Margin="10" Opacity="0.9">
                            <TextBlock>
                                <Run Text="Low" FontWeight="SemiBold"/>
                                <Run Text="(" FontWeight="SemiBold"/><Run Text="{x:Bind vm.Chart.TimeSpan}" FontWeight="SemiBold"/><Run Text=")" FontWeight="SemiBold"/>
                                <LineBreak/>
                                <Run Text="{x:Bind vm.Chart.PricesMinMax.Item1,
                                    Converter={StaticResource NumberFormatter}}"/><Run Text="{x:Bind
                                    vm.Coin.CurrencySym}"/>
                            </TextBlock>
                            <TextBlock>
                                <Run Text="High" FontWeight="SemiBold"/>
                                <Run Text="(" FontWeight="SemiBold"/><Run Text="{x:Bind vm.Chart.TimeSpan}" FontWeight="SemiBold"/><Run Text=")" FontWeight="SemiBold"/>
                                <LineBreak/>
                                <Run Text="{x:Bind vm.Chart.PricesMinMax.Item2,
                                    Converter={StaticResource NumberFormatter}}"/><Run Text="{x:Bind
                                    vm.Coin.CurrencySym}"/>
                            </TextBlock>

                            <TextBlock>
                                <Run Text="All time low:" FontWeight="SemiBold"/>
                                <LineBreak/>
                                <Run Text="{x:Bind vm.CoinInfo.market_data.atl.eur,
                                    Converter={StaticResource NumberFormatter}}"/><Run Text="{x:Bind
                                    vm.Coin.CurrencySym}"/>
                                <Run Text="{x:Bind vm.CoinInfo.market_data.atl_date.eur,
                                    Converter={StaticResource DateShortener}}" FontWeight="Light" FontSize="11"
                                    Foreground="{ThemeResource TextBoxDisabledForegroundThemeBrush}"/>
                            </TextBlock>
                            <TextBlock>
                                <Run Text="All time high:" FontWeight="SemiBold"/>
                                <LineBreak/>
                                <Run Text="{x:Bind vm.CoinInfo.market_data.ath.eur,
                                    Converter={StaticResource NumberFormatter}}"/><Run Text="{x:Bind vm.Coin.CurrencySym}"/>
                                <Run Text="{x:Bind vm.CoinInfo.market_data.ath_date.eur, Converter={StaticResource DateShortener}}"
                                     FontWeight="Light" FontSize="11"
                                     Foreground="{ThemeResource TextBoxDisabledForegroundThemeBrush}"/>
                            </TextBlock>
                        </controls:UniformGrid>
                    </StackPanel>


                    <!-- Global Market card -->
                    <StackPanel Style="{ThemeResource CardStackPanel}">
                        <RelativePanel Style="{ThemeResource CardRelativePanelTitle}">
                            <TextBlock Text="Global Market" Style="{ThemeResource SubtitleTextBlockStyle}" FontWeight="Bold"/>
                            <TextBlock Style="{ThemeResource SubtitleTextBlockStyle}" FontWeight="SemiBold" RelativePanel.AlignRightWithPanel="True">
                                <Run Text="#"/><Run Text="{x:Bind vm.CoinInfo.market_cap_rank}"/>
                            </TextBlock>
                        </RelativePanel>

                        <controls:UniformGrid Margin="10" Columns="1" Opacity="0.9">
                            <TextBlock Margin="5" FontSize="16" FontWeight="Light">
                                <Run Text="Market Cap:" FontWeight="SemiBold"/>
                                <LineBreak/>
                                <Run Text="{x:Bind vm.CoinInfo.market_data.market_cap.eur,
                                    Converter={StaticResource NumberPrefixer}}"/><!--
                                --><Run Text="{x:Bind vm.Coin.CurrencySym}"/>
                                <Run Text="(" FontWeight="Light" FontSize="11"/><Run 
                                    Text="{x:Bind vm.CoinInfo.market_data.market_cap_change_percentage_24h}"
                                    FontWeight="Light" FontSize="11"/><Run
                                    Text="%)" FontWeight="Light" FontSize="11"/>
                            </TextBlock>
                            <TextBlock Margin="5" FontSize="16" FontWeight="Light">
                                <Run Text="Circulating supply" FontWeight="SemiBold"/>
                                <LineBreak/>
                                <Run Text="{x:Bind vm.CoinInfo.market_data.circulating_supply,
                                        Converter={StaticResource StringFormatConverter}}"/>
                                <Run Text="{x:Bind vm.Coin.Name}"/>
                            </TextBlock>
                        </controls:UniformGrid>
                    </StackPanel>
                    
                </controls:UniformGrid>


                <!--
                <ListView Grid.Row="1" x:Name="MarketList" SelectionMode="None" Margin="-10 0 0 0" Background="Blue" Visibility="Collapsed">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="helpers:JSONexchanges">
                            <Grid BorderBrush="{ThemeResource SystemControlForegroundListLowBrush}" BorderThickness="0 0 0 2" Padding="0 0 0 5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel>
                                    <TextBlock Text="{x:Bind Exchange    , Mode=TwoWay}" Style="{ThemeResource SubtitleTextBlockStyle}" FontWeight="Normal"/>
                                    <TextBlock Text="{x:Bind T_Volume24  , Mode=TwoWay}" Style="{ThemeResource CaptionTextBlockStyle}"  FontWeight="Light"/>
                                    <TextBlock Text="{x:Bind T_Volume24To, Mode=TwoWay}" Style="{ThemeResource CaptionTextBlockStyle}"  FontWeight="Light"/>
                                </StackPanel>

                                <TextBlock Text="{x:Bind Price}" Style="{ThemeResource SubtitleTextBlockStyle}" Grid.Column="1" FontWeight="SemiLight"/>

                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
                -->
            </Grid>
        </ScrollViewer>

    </Grid>
</Page>

    